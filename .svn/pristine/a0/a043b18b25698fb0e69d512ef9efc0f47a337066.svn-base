/*jslint onevar: false, plusplus: false *//*

 JS Beautifier
---------------


  Written by Einar Lielmanis, <einar@jsbeautifier.org>
      http://jsbeautifier.org/

  Originally converted to javascript by Vital, <vital76@gmail.com>

  You are free to use this in any way you want, in case you find this useful or working for you.

  Usage:
    js_beautify(js_source_text);
    js_beautify(js_source_text, options);

  The options are:
    indent_size (default 4)          — indentation size,
    indent_char (default space)      — character to indent with,
    preserve_newlines (default true) — whether existing line breaks should be preserved,
    preserve_max_newlines (default unlimited) - maximum number of line breaks to be preserved in one chunk,
    indent_level (default 0)         — initial indentation level, you probably won't need this ever,

    space_after_anon_function (default false) — if true, then space is added between "function ()"
            (jslint is happy about this); if false, then the common "function()" output is used.
    braces_on_own_line (default false) - ANSI / Allman brace style, each opening/closing brace gets its own line.

    e.g

    js_beautify(js_source_text, {indent_size: 1, indent_char: '\t'});


*/function js_beautify(a,b){function U(){x=0;if(p>=G)return["","TK_EOF"];v=!1;var a=c.charAt(p);p+=1;var b=F&&P(j.mode);if(b){var e=0;while(S(a,m)){a==="\n"?(H(),d.push("\n"),w=!0,e=0):a==="\t"?e+=4:a!=="\r"&&(e+=1);if(p>=G)return["","TK_EOF"];a=c.charAt(p),p+=1}j.indentation_baseline===-1&&(j.indentation_baseline=e);if(w){var h;for(h=0;h<j.indentation_level+1;h+=1)d.push(l);if(j.indentation_baseline!==-1)for(h=0;h<e-j.indentation_baseline;h++)d.push(" ")}}else{while(S(a,m)){a==="\n"&&(x+=C?x<=C?1:0:1);if(p>=G)return["","TK_EOF"];a=c.charAt(p),p+=1}if(B)if(x>1)for(h=0;h<x;h+=1)J(h===0),w=!0;v=x>0}if(S(a,n)){if(p<G)while(S(c.charAt(p),n)){a+=c.charAt(p),p+=1;if(p===G)break}if(p!==G&&a.match(/^[0-9]+[Ee]$/)&&(c.charAt(p)==="-"||c.charAt(p)==="+")){var i=c.charAt(p);p+=1;var k=U(p);a+=i+k[0];return[a,"TK_WORD"]}if(a==="in")return[a,"TK_OPERATOR"];v&&f!=="TK_OPERATOR"&&!j.if_line&&(B||g!=="var")&&J();return[a,"TK_WORD"]}if(a==="("||a==="[")return[a,"TK_START_EXPR"];if(a===")"||a==="]")return[a,"TK_END_EXPR"];if(a==="{")return[a,"TK_START_BLOCK"];if(a==="}")return[a,"TK_END_BLOCK"];if(a===";")return[a,"TK_SEMICOLON"];if(a==="/"){var q="",s=!0;if(c.charAt(p)==="*"){if((p+=1)<G)while((c.charAt(p)!=="*"||!c.charAt(p+1)||c.charAt(p+1)!=="/")&&p<G){a=c.charAt(p),q+=a;if(a==="\r"||a==="\n")s=!1;p+=1;if(p>=G)break}p+=2;return s?["/*"+q+"*/","TK_INLINE_COMMENT"]:["/*"+q+"*/","TK_BLOCK_COMMENT"]}if(c.charAt(p)==="/"){q=a;while(c.charAt(p)!=="\r"&&c.charAt(p)!=="\n"){q+=c.charAt(p),p+=1;if(p>=G)break}p+=1,v&&J();return[q,"TK_COMMENT"]}}if(a==="'"||a==='"'||a==="/"&&(f==="TK_WORD"&&S(g,["return","do"])||(f==="TK_COMMENT"||f==="TK_START_EXPR"||f==="TK_START_BLOCK"||f==="TK_END_BLOCK"||f==="TK_OPERATOR"||f==="TK_EQUALS"||f==="TK_EOF"||f==="TK_SEMICOLON"))){var t=a,u=!1,y=a;if(p<G)if(t==="/"){var z=!1;while(u||z||c.charAt(p)!==t){y+=c.charAt(p),u?u=!1:(u=c.charAt(p)==="\\",c.charAt(p)==="["?z=!0:c.charAt(p)==="]"&&(z=!1)),p+=1;if(p>=G)return[y,"TK_STRING"]}}else while(u||c.charAt(p)!==t){y+=c.charAt(p),u?u=!1:u=c.charAt(p)==="\\",p+=1;if(p>=G)return[y,"TK_STRING"]}p+=1,y+=t;if(t==="/")while(p<G&&S(c.charAt(p),n))y+=c.charAt(p),p+=1;return[y,"TK_STRING"]}if(a==="#"){if(d.length===0&&c.charAt(p)==="!"){y=a;while(p<G&&a!="\n")a=c.charAt(p),y+=a,p+=1;d.push(I(y)+"\n"),J();return U()}var A="#";if(p<G&&S(c.charAt(p),r)){do a=c.charAt(p),A+=a,p+=1;while(p<G&&a!=="#"&&a!=="=");a!=="#"&&(c.charAt(p)==="["&&c.charAt(p+1)==="]"?(A+="[]",p+=2):c.charAt(p)==="{"&&c.charAt(p+1)==="}"&&(A+="{}",p+=2));return[A,"TK_WORD"]}}if(a==="<"&&c.substring(p-1,p+3)==="<!--"){p+=3,j.in_html_comment=!0;return["<!--","TK_COMMENT"]}if(a==="-"&&j.in_html_comment&&c.substring(p-1,p+2)==="-->"){j.in_html_comment=!1,p+=2,v&&J();return["-->","TK_COMMENT"]}if(S(a,o)){while(p<G&&S(a+c.charAt(p),o)){a+=c.charAt(p),p+=1;if(p>=G)break}return a==="="?[a,"TK_EQUALS"]:[a,"TK_OPERATOR"]}return[a,"TK_UNKNOWN"]}function T(){for(var a=0,b=0,c=d.length-1;c>=0;c--)switch(d[c]){case":":a===0&&++b;break;case"?":if(a===0){if(b===0)return!0;--b}break;case"{":if(a===0)return!1;--a;break;case"(":case"[":--a;break;case")":case"]":case"}":++a}}function S(a,b){for(var c=0;c<b.length;c+=1)if(b[c]===a)return!0;return!1}function R(){u=j.mode==="DO_BLOCK",k.length>0&&(j=k.pop())}function Q(a){return a==="[EXPRESSION]"||a==="[INDENTED-EXPRESSION]"||a==="(EXPRESSION)"}function P(a){return a==="[EXPRESSION]"||a==="[INDENTED-EXPRESSION]"}function O(a){j&&k.push(j),j={previous_mode:j?j.mode:"BLOCK",mode:a,var_line:!1,var_line_tainted:!1,var_line_reindented:!1,in_html_comment:!1,if_line:!1,in_case:!1,eat_next_space:!1,indentation_baseline:-1,indentation_level:j?j.indentation_level+(j.var_line&&j.var_line_reindented?1:0):D}}function N(){d.length&&d[d.length-1]===l&&d.pop()}function M(){j.indentation_level+=1}function L(){w=!1,j.eat_next_space=!1,d.push(e)}function K(){if(j.eat_next_space)j.eat_next_space=!1;else{var a=" ";d.length&&(a=d[d.length-1]),a!==" "&&a!=="\n"&&a!==l&&d.push(" ")}}function J(a){j.eat_next_space=!1;if(!F||!P(j.mode)){a=typeof a==="undefined"?!0:a,j.if_line=!1,H();if(!d.length)return;if(d[d.length-1]!=="\n"||!a)w=!0,d.push("\n");for(var b=0;b<j.indentation_level;b+=1)d.push(l);j.var_line&&j.var_line_reindented&&(A===" "?d.push("    "):d.push(l))}}function I(a){return a.replace(/^\s\s*|\s\s*$/,"")}function H(a){a=typeof a==="undefined"?!1:a;while(d.length&&(d[d.length-1]===" "||d[d.length-1]===l||a&&(d[d.length-1]==="\n"||d[d.length-1]==="\r")))d.pop()}var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;b=b?b:{};var y=b.braces_on_own_line?b.braces_on_own_line:!1,z=b.indent_size?b.indent_size:4,A=b.indent_char?b.indent_char:" ",B=typeof b.preserve_newlines==="undefined"?!0:b.preserve_newlines,C=typeof b.max_preserve_newlines==="undefined"?!1:b.max_preserve_newlines,D=b.indent_level?b.indent_level:0,E=b.space_after_anon_function==="undefined"?!1:b.space_after_anon_function,F=typeof b.keep_array_indentation==="undefined"?!1:b.keep_array_indentation;w=!1;var G=a.length;l="";while(z>0)l+=A,z-=1;c=a,i="",f="TK_START_EXPR",h=g="",d=[],u=!1,m="\n\r\t ".split(""),n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_$".split(""),r="0123456789".split(""),o="+ - * / % & ++ -- = += -= *= /= %= == === != !== > < >= <= >> << >>> >>>= >>= <<= && &= | || ! !! , : ? ^ ^= |= ::".split(" "),q="continue,try,throw,return,var,if,switch,case,default,for,while,break,function".split(","),k=[],O("BLOCK"),p=0;while(!0){var V=U(p);e=V[0],t=V[1];if(t==="TK_EOF")break;switch(t){case"TK_START_EXPR":if(e==="["){if(f==="TK_WORD"||g===")"){S(g,q)&&K(),O("(EXPRESSION)"),L();break}j.mode==="[EXPRESSION]"||j.mode==="[INDENTED-EXPRESSION]"?h==="]"&&g===","?(j.mode==="[EXPRESSION]"&&(j.mode="[INDENTED-EXPRESSION]",F||M()),O("[EXPRESSION]"),F||J()):g==="["?(j.mode==="[EXPRESSION]"&&(j.mode="[INDENTED-EXPRESSION]",F||M()),O("[EXPRESSION]"),F||J()):O("[EXPRESSION]"):O("[EXPRESSION]")}else O("(EXPRESSION)");g===";"||f==="TK_START_BLOCK"?J():f!=="TK_END_EXPR"&&f!=="TK_START_EXPR"&&f!=="TK_END_BLOCK"&&g!=="."&&(f!=="TK_WORD"&&f!=="TK_OPERATOR"?K():i==="function"?E&&K():(S(g,q)||g==="catch")&&K()),L();break;case"TK_END_EXPR":if(e==="]")if(F){if(g==="}"){N(),L(),R();break}}else if(j.mode==="[INDENTED-EXPRESSION]")if(g==="]"){R(),J(),L();break}R(),L();break;case"TK_START_BLOCK":i==="do"?O("DO_BLOCK"):O("BLOCK"),y?(f!=="TK_OPERATOR"&&(g=="return"?K():J(!0)),L(),M()):(f!=="TK_OPERATOR"&&f!=="TK_START_EXPR"?f==="TK_START_BLOCK"?J():K():P(j.previous_mode)&&g===","&&(h==="}"?K():J()),M(),L());break;case"TK_END_BLOCK":R(),y?(J(),L()):(f==="TK_START_BLOCK"?w?N():H():P(j.mode)&&F?(F=!1,J(),F=!0):J(),L());break;case"TK_WORD":if(u){K(),L(),K(),u=!1;break}if(e==="function")if((w||g===";")&&g!=="{"){x=w?x:0,B||(x=1);for(var W=0;W<2-x;W++)J(!1)}if(e==="case"||e==="default"){g===":"?N():(--j.indentation_level,J(),++j.indentation_level),L(),j.in_case=!0;break}s="NONE",f==="TK_END_BLOCK"?S(e.toLowerCase(),["else","catch","finally"])?y?s="NEWLINE":(s="SPACE",K()):s="NEWLINE":f!=="TK_SEMICOLON"||j.mode!=="BLOCK"&&j.mode!=="DO_BLOCK"?f==="TK_SEMICOLON"&&Q(j.mode)?s="SPACE":f==="TK_STRING"?s="NEWLINE":f==="TK_WORD"?s="SPACE":f==="TK_START_BLOCK"?s="NEWLINE":f==="TK_END_EXPR"&&(K(),s="NEWLINE"):s="NEWLINE",j.if_line&&f==="TK_END_EXPR"&&(j.if_line=!1);if(S(e.toLowerCase(),["else","catch","finally"]))f!=="TK_END_BLOCK"||y?J():(H(!0),K());else if(S(e,q)||s==="NEWLINE"){if(f!=="TK_START_EXPR"&&g!=="="&&g!==","||e!=="function")g==="return"||g==="throw"?K():f!=="TK_END_EXPR"?(f!=="TK_START_EXPR"||e!=="var")&&g!==":"&&(e==="if"&&i==="else"&&g!=="{"?K():J()):S(e,q)&&g!==")"&&J()}else P(j.mode)&&g===","&&h==="}"?J():s==="SPACE"&&K();L(),i=e,e==="var"&&(j.var_line=!0,j.var_line_reindented=!1,j.var_line_tainted=!1),e==="if"&&(j.if_line=!0),e==="else"&&(j.if_line=!1);break;case"TK_SEMICOLON":L(),j.var_line=!1,j.var_line_reindented=!1;break;case"TK_STRING":f==="TK_START_BLOCK"||f==="TK_END_BLOCK"||f==="TK_SEMICOLON"?J():f==="TK_WORD"&&K(),L();break;case"TK_EQUALS":j.var_line&&(j.var_line_tainted=!0),K(),L(),K();break;case"TK_OPERATOR":var X=!0,Y=!0;j.var_line&&e===","&&Q(j.mode)&&(j.var_line_tainted=!1);if(j.var_line)if(e===","){if(j.var_line_tainted){L(),j.var_line_reindented=!0,j.var_line_tainted=!1,J();break}j.var_line_tainted=!1}if(g==="return"||g==="throw"){K(),L();break}if(e===":"&&j.in_case){L(),J(),j.in_case=!1;break}if(e==="::"){L();break}if(e===","){j.var_line?j.var_line_tainted?(L(),J(),j.var_line_tainted=!1):(L(),K()):f==="TK_END_BLOCK"&&j.mode!=="(EXPRESSION)"?(L(),j.mode==="OBJECT"&&g==="}"?J():K()):j.mode==="OBJECT"?(L(),J()):(L(),K());break}S(e,["--","++","!"])||S(e,["-","+"])&&(S(f,["TK_START_BLOCK","TK_START_EXPR","TK_EQUALS","TK_OPERATOR"])||S(g,q))?(X=!1,Y=!1,g===";"&&Q(j.mode)&&(X=!0),f==="TK_WORD"&&S(g,q)&&(X=!0),j.mode==="BLOCK"&&(g==="{"||g===";")&&J()):e==="."?X=!1:e===":"&&(T()||(j.mode="OBJECT",X=!1)),X&&K(),L(),Y&&K(),e!=="!";break;case"TK_BLOCK_COMMENT":var Z=e.split(/\x0a|\x0d\x0a/);if(/^\/\*\*/.test(e))for(J(),d.push(Z[0]),W=1;W<Z.length;W++)J(),d.push(" "),d.push(I(Z[W]));else for(Z.length>1?(J(),H()):K(),W=0;W<Z.length;W++)d.push(Z[W]),d.push("\n");J();break;case"TK_INLINE_COMMENT":K(),L(),Q(j.mode)?K():J();break;case"TK_COMMENT":v?J():K(),L(),J();break;case"TK_UNKNOWN":(g==="return"||g==="throw")&&K(),L()}h=g,f=t,g=e}return d.join("").replace(/[\n ]+$/,"")}typeof exports!=="undefined"&&(exports.js_beautify=js_beautify)